<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>CyberWatch Pro - Dashboard</title>
    <style>
        :root { --bg: #0f172a; --card: #1e293b; --text: #f8fafc; --accent: #38bdf8; --success: #22c55e; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); padding: 20px; }
        .container { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 20px; }
        .card { background: var(--card); border-radius: 12px; padding: 20px; border: 1px solid #334155; min-height: 450px; }
        h2 { color: var(--accent); border-bottom: 2px solid var(--accent); padding-bottom: 10px; font-size: 1.1rem; }
        .item { margin-bottom: 12px; padding: 10px; background: #2d3748; border-radius: 6px; border-left: 4px solid var(--accent); font-size: 0.85rem; }
        a { color: #61dafb; text-decoration: none; font-weight: bold; display: block; margin-bottom: 5px; }
        .date { color: #94a3b8; font-size: 0.75rem; }
        .btn { background: #38bdf8; color: #0f172a; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; font-weight: bold; margin-top: 10px; }
    </style>
</head>
<body>

<h1 style="text-align:center;">üõ°Ô∏è Mon Dashboard Cyber S√©curit√©</h1>

<div class="container">
    <div class="card">
        <h2>üá´üá∑ CERT-FR (ANSSI)</h2>
        <div id="anssi-feed">Chargement des alertes...</div>
    </div>
    <div class="card">
        <h2>üíª Failles Microsoft</h2>
        <div id="ms-feed">Recherche des vuln√©rabilit√©s...</div>
    </div>
    <div class="card">
        <h2>‚úÖ Outils & Liens</h2>
        <p>En cas de probl√®me de flux :</p>
        <button class="btn" onclick="window.open('https://www.cert.ssi.gouv.fr/')">Site du CERT-FR</button>
        <button class="btn" onclick="window.open('https://www.virustotal.com')">VirusTotal</button>
        <button class="btn" onclick="location.reload()">Actualiser</button>
    </div>
</div>

<script>
    // Utilisation d'un proxy diff√©rent pour √©viter les erreurs de message channel
    const PROXY = "https://api.allorigins.win/get?url=";

    async function loadCyberFeed(url, containerId, keyword = "") {
        const container = document.getElementById(containerId);
        try {
            const response = await fetch(PROXY + encodeURIComponent(url));
            const data = await response.json();
            
            // On utilise le parseur natif du navigateur (pas besoin de biblioth√®que externe)
            const parser = new DOMParser();
            const xmlDoc = parser.parseFromString(data.contents, "text/xml");
            const items = xmlDoc.querySelectorAll("item");
            
            container.innerHTML = "";
            let displayedCount = 0;

            items.forEach(item => {
                const title = item.querySelector("title").textContent;
                const link = item.querySelector("link").textContent;
                const pubDate = item.querySelector("pubDate") ? item.querySelector("pubDate").textContent : "";

                // Filtrage par mot-cl√© si n√©cessaire
                if (displayedCount < 6 && (keyword === "" || title.toLowerCase().includes(keyword.toLowerCase()))) {
                    const div = document.createElement('div');
                    div.className = 'item';
                    div.innerHTML = `
                        <a href="${link}" target="_blank">${title}</a>
                        <span class="date">üìÖ ${pubDate.split(' ').slice(0, 4).join(' ')}</span>
                    `;
                    container.appendChild(div);
                    displayedCount++;
                }
            });

            if (displayedCount === 0) {
                container.innerHTML = "Aucune alerte r√©cente trouv√©e.";
            }

        } catch (error) {
            console.error(error);
            container.innerHTML = "<p style='color:#ef4444'>‚ö†Ô∏è Erreur de chargement. V√©rifiez votre connexion ou d√©sactivez votre bloqueur de pub.</p>";
        }
    }

    // Lancement direct
    loadCyberFeed("https://www.cert.ssi.gouv.fr/feed/", "anssi-feed");
    loadCyberFeed("https://www.cert-ist.com/monespace/fluxrss", "ms-feed", "Microsoft");
</script>

</body>
</html>
